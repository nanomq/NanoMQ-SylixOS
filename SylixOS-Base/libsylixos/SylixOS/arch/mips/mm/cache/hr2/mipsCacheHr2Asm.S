;/*********************************************************************************************************
;**
;**                                    中国软件开源组织
;**
;**                                   嵌入式实时操作系统
;**
;**                                       SylixOS(TM)
;**
;**                               Copyright  All Rights Reserved
;**
;**--------------文件信息--------------------------------------------------------------------------------
;**
;** 文   件   名: mipsCacheHr2Asm.S
;**
;** 创   建   人: Jiao.JinXing (焦进星)
;**
;** 文件创建日期: 2018 年 03 月 14 日
;**
;** 描        述: 华睿 2 号处理器 CACHE 驱动.
;*********************************************************************************************************/

#ifndef ASSEMBLY
#define ASSEMBLY 1
#endif

#include <arch/assembler.h>
#include <config/kernel/cache_cfg.h>
#include <config/cpu/cpu_cfg_mips.h>

#if LW_CFG_CACHE_EN > 0

    EXPORT_LABEL(hr2CacheEnableHw)

    FILE_BEGIN()

;/*********************************************************************************************************
;  使能 CACHE
;*********************************************************************************************************/

FUNC_DEF(hr2CacheEnableHw)
    MFC0_EHB(T0, CP0_CONFIG)
    ANDI        T0 , T0 , CONF_CM_CMASK
    LI          T1 , 6
    BEQ         T0 , T1 , 1f
    NOP

    MFC0_EHB(T0, CP0_CONFIG)
    AND         T0 , T0 , ~CONF_CM_CMASK
    ORI         T0 , 6
    MTC0_EHB(T0, CP0_CONFIG)

1:
    JR          RA
    NOP
    FUNC_END(hr2CacheEnableHw)

    FILE_END()

#endif
;/*********************************************************************************************************
;  END
;*********************************************************************************************************/
